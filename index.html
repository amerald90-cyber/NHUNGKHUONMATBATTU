<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Những Gương Mặt Bất Tử</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: #240046; }
        iframe { border: none; width: 100%; height: 100%; display: block; }
        #music-btn {
            position: fixed; bottom: 25px; right: 25px; z-index: 9999;
            width: 55px; height: 55px; background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        #music-icon { width: 25px; height: 25px; filter: invert(1); }
        .is-playing { animation: pulse 1.5s infinite; background: rgba(255,255,255,0.4) !important; }
        @keyframes pulse {
            0% { transform: scale(1); }
            70% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="music-btn" onclick="toggleMusic()">
        <img id="music-icon" src="https://cdn-icons-png.flaticon.com/512/3103/3103443.png">
    </div>

    <audio id="bgMusic" loop></audio>

    <script>
        // THAY LINK WEB APP CỦA BẠN VÀO ĐÂY
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwsiZW2nFBAILkM_uZfYgBFEr1Hq_KEgOo3XQ1SGBtvmGKUsLKmMiLWLak8107Cj2bD/exec";
        
        var audio = document.getElementById('bgMusic');
        var btn = document.getElementById('music-btn');
        var icon = document.getElementById('music-icon');

        function formatDriveLink(link) {
            if (link.includes('drive.google.com')) {
                let id = link.split('/d/')[1]?.split('/')[0] || link.split('id=')[1]?.split('&')[0];
                return `https://docs.google.com/uc?export=download&id=${id}`;
            }
            return link;
        }

        // Tự động lấy nhạc từ Sheet
        async function fetchMusic() {
            try {
                const response = await fetch(SCRIPT_URL + "?action=getMusic");
                const musicLink = await response.text();
                if (musicLink && musicLink.includes("http")) {
                    audio.src = formatDriveLink(musicLink);
                    console.log("Đã tải nhạc thành công");
                }
            } catch (e) { console.error("Lỗi lấy nhạc:", e); }
        }

        function toggleMusic() {
            if (!audio.src) return;
            if (audio.paused) {
                audio.play();
                btn.classList.add('is-playing');
                icon.src = "https://cdn-icons-png.flaticon.com/512/727/727269.png";
            } else {
                audio.pause();
                btn.classList.remove('is-playing');
                icon.src = "https://cdn-icons-png.flaticon.com/512/3103/3103443.png";
            }
        }

        document.addEventListener('click', () => { if(audio.paused) toggleMusic(); }, { once: true });
        fetchMusic();
    </script>

    <iframe src="https://script.google.com/macros/s/AKfycbxlVIXWnPnD3vLSxNEx1WZH-PJm92t1vtizdL2NGKQTJKLGRyJPdkaxsikPehjRr_c/exec" allow="autoplay"></iframe>

</body>
</html>