<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Những Gương Mặt Bất Tử</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: #240046; }
        iframe { border: none; width: 100%; height: 100%; display: block; position: relative; z-index: 1; }
        
        #music-btn {
            position: fixed; bottom: 30px; right: 30px; z-index: 999999;
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #music-icon { width: 30px; height: 30px; filter: invert(1); }
        .is-playing { animation: pulse 1.5s infinite; background: rgba(255,255,255,0.5) !important; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="music-btn" onclick="toggleMusic()">
        <img id="music-icon" src="https://cdn-icons-png.flaticon.com/512/3103/3103443.png">
    </div>

    <!-- AUDIO: Gán sẵn link ID của bạn để chạy ngay lập tức -->
    <audio id="bgMusic" loop preload="auto" src="https://docs.google.com/uc?export=download&id=1BiuyiKZIjREMzlH13BQHwsQB2V81gTku"></audio>

    <script>
        const APP_URL = "https://script.google.com/macros/s/AKfycbwsiZW2nFBAILkM_uZfYgBFEr1Hq_KEgOo3XQ1SGBtvmGKUsLKmMiLWLak8107Cj2bD/exec";
        var audio = document.getElementById('bgMusic');
        var btn = document.getElementById('music-btn');
        var icon = document.getElementById('music-icon');

        function fixLink(url) {
            if (!url || url.trim() === "") return "https://docs.google.com/uc?export=download&id=1BiuyiKZIjREMzlH13BQHwsQB2V81gTku";
            var id = url.match(/[-\w]{25,}/);
            return id ? "https://docs.google.com/uc?export=download&id=" + id[0] : url;
        }

        // Cập nhật link từ Sheet (nếu sau này bạn đổi bài khác)
        async function refreshMusicLink() {
            try {
                const resp = await fetch(APP_URL + "?get=music");
                const newLink = await resp.text();
                if (newLink && newLink.length > 10) {
                    audio.src = fixLink(newLink);
                }
            } catch (e) { console.log("Dùng link nhạc mặc định."); }
        }

        function toggleMusic() {
            if (audio.paused) {
                audio.play().then(() => {
                    btn.classList.add('is-playing');
                    icon.src = "https://cdn-icons-png.flaticon.com/512/727/727269.png";
                }).catch(err => {
                    console.log("Chờ tương tác người dùng...");
                });
            } else {
                audio.pause();
                btn.classList.remove('is-playing');
                icon.src = "https://cdn-icons-png.flaticon.com/512/3103/3103443.png";
            }
        }

        // Tự động phát khi chạm bất kỳ đâu
        document.addEventListener('click', () => { if(audio.paused) toggleMusic(); }, {once: true});
        document.addEventListener('touchstart', () => { if(audio.paused) toggleMusic(); }, {once: true});

        refreshMusicLink();
    </script>

    <iframe src="https://script.google.com/macros/s/AKfycbyW4pGwnISKl5fH562jK14BWOeMBLBYbp8IeUiReqsdo2PHh8HpX6t1b-vv3YHHta7N/exec" allow="autoplay"></iframe>

</body>
</html>
